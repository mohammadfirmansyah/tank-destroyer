<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tank Destroyer: Ultimate Edition</title>
    <!-- Cache Buster - Must be first to clear stale assets -->
    <script src="js/cache-buster.js"></script>
    <!-- Local font definitions -->
    <link rel="stylesheet" href="assets/fonts/fonts.css">
    <!-- Tailwind CSS v4 (local file) -->
    <script src="js/tailwind.js"></script>
    <!-- Critical CSS - Inline to prevent flash of unstyled content -->
    <style>
        /* Body starts invisible, fades in when assets loaded */
        html { background: #000; }
        body { 
            margin: 0; 
            padding: 0; 
            background: #000; 
            opacity: 0; 
            transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Rajdhani', system-ui, sans-serif;
            font-weight: 500;
        }
        body.loaded { opacity: 1; }
        /* Ensure all text uses Rajdhani by default */
        *, *::before, *::after {
            font-family: inherit;
        }
        /* Custom font classes that override Tailwind defaults */
        .font-black { font-weight: 900; font-family: 'Black Ops One', 'Impact', sans-serif !important; }
        .font-display { font-family: 'Black Ops One', 'Impact', sans-serif !important; }
    </style>
    <!-- Main game styles (loads after Tailwind to override) -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <!-- SPLASH SCREEN -->
    <div id="splash-screen">
        <div class="splash-content">
            <!-- Page 1: Game Title -->
            <div class="splash-page" data-page="1">
                <h1 class="splash-title">TANK DESTROYER</h1>
                <div class="splash-subtitle">ULTIMATE EDITION</div>
            </div>
            
            <!-- Page 2: Developer Info -->
            <div class="splash-page next" data-page="2">
                <div class="splash-dev">
                    <div class="dev-label">PRODUCED BY</div>
                    <div class="dev-branding">
                        <div class="dev-crest">
                            <span class="dev-crest-ring"></span>
                            <span class="dev-crest-core">FDS</span>
                        </div>
                    </div>
                    <div class="dev-name">Firman Dev Studio</div>
                    <div class="dev-tagline">Premium Interactive Entertainment</div>
                </div>
            </div>
            
            <!-- Page 3: Health Warning -->
            <div class="splash-page next" data-page="3">
                <div class="health-warning">
                    <div class="warning-icon">‚ö†Ô∏è</div>
                    <div class="warning-text">
                        <strong>HEALTH WARNING:</strong> This game contains flashing lights and intense visual effects.
                        Take regular breaks. If you experience dizziness or discomfort, stop playing immediately.
                    </div>
                </div>
            </div>
            
            <!-- Loading bar - consistent across all pages -->
            <div class="splash-loading">
                <div class="loading-bar"></div>
                <div class="loading-text">LOADING BATTLEFIELD...</div>
            </div>
            
            <!-- Pagination Dots -->
            <div class="splash-pagination">
                <span class="dot" data-page="1"></span>
                <span class="dot" data-page="2"></span>
                <span class="dot" data-page="3"></span>
            </div>
            
            <div class="splash-hint">TAP TO CONTINUE</div>
        </div>
    </div>

    <!-- DEMO BATTLE CANVAS (Background for homepage) -->
    <canvas id="demoCanvas"></canvas>

    <canvas id="gameCanvas"></canvas>
    
    <!-- UI LAYER -->
    <div id="ui-layer">
        <!-- Achievement Popup Container -->
        <div id="achievement-popup-container"></div>

        <div class="hud-top">
            <div class="stats-panel">
                <div id="hp-bar-group" class="bar-group bar-visible">
                    <div class="bar-label"><span>HP</span><span id="revive-indicator" style="color:#ff69b4;font-weight:900;margin-left:8px;">‚ù§Ô∏è 0x</span></div>
                    <div class="bar-frame"><div id="hp-fill" class="bar-fill hp-fill" style="width: 100%;"></div><div id="hp-text" class="bar-value">200/200</div></div>
                </div>
                <div id="armor-bar-group" class="bar-group bar-hidden" style="margin-top:4px;">
                    <div class="bar-label"><span>ARMOR</span></div>
                    <div class="bar-frame"><div id="armor-fill" class="bar-fill armor-fill" style="width: 0%;"></div><div id="armor-text" class="bar-value">0</div></div>
                </div>
                <div id="energy-bar-group" class="bar-group bar-visible" style="margin-top:4px;">
                    <div class="bar-label"><span>WEAPON ENERGY</span><span id="temp-indicator" style="color:#00ff00;font-weight:900;margin-left:8px;">20¬∞C</span></div>
                    <div class="bar-frame"><div id="en-fill" class="bar-fill en-fill" style="width: 100%;"></div><div id="en-text" class="bar-value">100%</div></div>
                </div>
                <div id="ks-bar-group" class="bar-group bar-visible" style="margin-top:4px;">
                    <div class="bar-label"><span>KILL STREAK</span></div>
                    <div class="bar-frame"><div id="ks-fill" class="bar-fill ks-fill" style="width: 0%;"></div></div>
                </div>
                <div id="weapon-name" class="weapon-info">CANNON</div>
                <!-- Passive Item Indicators (dmgmult, critical, etc.) -->
                <div id="passive-indicators" class="passive-indicators"></div>
            </div>
            
            <div class="top-right">
                <canvas id="minimap" class="minimap-box" width="110" height="110"></canvas>
                <div class="pause-btn" id="pause-btn">II</div>
                <!-- Wave Indicator - Positioned responsively -->
                <div id="wave-indicator">WAVE 1</div>
            </div>
        </div>

        <div id="boss-warning">‚ö† MOTHERSHIP DETECTED ‚ö†</div>
        
        <!-- FPS Debug HUD (only visible when DEBUG_SHOW_FPS=true or during homepage hold) -->
        <div id="fps-hud" class="fps-hud" style="display: none; opacity: 0;">
            <span id="fps-value" class="fps-value">-- FPS</span>
            <span class="fps-separator">‚îÇ</span>
            <span id="fps-avg" class="fps-avg">avg --</span>
            <span class="fps-separator">‚îÇ</span>
            <span id="fps-ms" class="fps-ms">-- ms</span>
        </div>
        
        <!-- Wave Transition Timer -->
        <div id="wave-timer" style="display: none;"></div>

        <div class="keyboard-hint desktop:block hidden">[ WASD: MOVE ] [ MOUSE/ARROWS: AIM & FIRE ]</div>

        <div class="controls-area">
            <!-- LEFT JOYSTICK -->
            <div class="joystick-container left-control">
                <div class="ability-slot ability-slot--turbo">
                    <div id="turbo-btn" class="turbo-btn ability-btn">
                        <span class="ability-main">TURBO</span>
                        <span class="ability-sub">EMPTY</span>
                    </div>
                </div>
                <div id="stick-l" class="joystick-base joy-left">
                    <div class="joystick-label">MOVE</div>
                    <div id="thumb-l" class="joystick-stick"></div>
                </div>
            </div>

            <!-- RIGHT JOYSTICK -->
            <div class="joystick-container right-control">
                <div class="ability-slot ability-slot--ult">
                    <div id="ult-btn" class="ult-btn ability-btn">
                        <span class="ability-main">ULTIMATE</span>
                        <span class="ability-sub">LOCKED</span>
                    </div>
                </div>
                <div id="stick-r" class="joystick-base joy-right">
                    <div class="joystick-label joystick-label-red">AIM & FIRE</div>
                    <div id="thumb-r" class="joystick-stick"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- MENUS -->
    <div id="overlay" class="hidden">
        <h1 class="font-black title-text" style="font-size: clamp(1.75rem, 8vw, 4.5rem); margin-bottom: clamp(0.5rem, 1vh, 1rem); line-height: 1;">TANK DESTROYER</h1>
        <div class="font-semibold" style="color: #8bc34a; font-size: clamp(0.65rem, 2.5vw, 1.25rem); letter-spacing: 0.3em; margin-bottom: clamp(1rem, 3vh, 2.5rem); font-family: 'Rajdhani', sans-serif;">ULTIMATE EDITION</div>
        <div class="score-list w-64" id="high-scores-list"><div class="text-sm" style="color: #d4c5b0;">Retrieving Data...</div></div>
        
        <div class="menu-buttons flex flex-col gap-4 w-64 items-center">
            <button id="resume-game-btn" class="inactive px-6 py-3 font-bold rounded border transition transform active:scale-95 tracking-widest cursor-pointer w-full" style="background: linear-gradient(135deg, #d97706, #fbbf24); color: #3e2c1c; border: 3px solid #b45309; box-shadow: 2px 2px 15px rgba(0,0,0,0.6);">RESUME BATTLE</button>
            <button id="start-btn" class="px-6 py-3 font-bold rounded border transition transform active:scale-95 tracking-widest cursor-pointer w-full" style="background: linear-gradient(135deg, #4a6741, #5a7a50); color: #d4c5b0; border: 3px solid #6b8055; box-shadow: 2px 2px 15px rgba(0,0,0,0.6);">DEPLOY TANK</button>
            <button id="achievements-btn" class="px-6 py-3 font-bold rounded border transition transform active:scale-95 tracking-widest cursor-pointer w-full" style="background: rgba(70, 60, 50, 0.9); color: #d4c5b0; border: 3px solid #8b7355; box-shadow: 2px 2px 10px rgba(0,0,0,0.5);">ACHIEVEMENTS</button>
        </div>
        
        <!-- Version Number -->
        <div class="version-number">v2.1.4</div>
        
        <!-- Music Credits & Toggle (Bottom Left) -->
        <div class="music-credits">
            <div class="music-controls-row">
                <div class="settings-btn" id="settings-btn" title="Graphics Settings">
                    <span class="settings-icon">‚öôÔ∏è</span>
                </div>
                <div class="music-toggle" id="music-toggle" title="Toggle Music">
                    <span class="music-icon" id="music-icon">üîä</span>
                </div>
            </div>
            <div class="music-text">Music from Army Men RTS (2002) OST</div>
        </div>
        
        <!-- Music Start Hint - Centered horizontally -->
        <div class="music-start-hint-container" id="music-start-hint">
            <div class="music-start-hint-box">
                <span class="hint-text">Tap anywhere to start music</span>
            </div>
        </div>
    </div>
    
    <!-- Demo Benchmark HUD - Shows when holding homepage background -->
    <div id="demo-benchmark-hud" class="demo-benchmark-hud">
        <div class="benchmark-header">
            <div class="benchmark-title">BENCHMARK MODE</div>
            <div class="benchmark-quality">
                <span class="quality-badge" id="bench-quality-badge">LOWEST</span>
            </div>
        </div>
        <div class="benchmark-stats">
            <div class="benchmark-row">
                <span class="benchmark-label">FPS</span>
                <span id="bench-fps" class="benchmark-value fps-value">--</span>
            </div>
            <div class="benchmark-row">
                <span class="benchmark-label">AVG</span>
                <span id="bench-avg" class="benchmark-value">--</span>
            </div>
            <div class="benchmark-row">
                <span class="benchmark-label">MIN</span>
                <span id="bench-min" class="benchmark-value">--</span>
            </div>
            <div class="benchmark-row">
                <span class="benchmark-label">MAX</span>
                <span id="bench-max" class="benchmark-value">--</span>
            </div>
            <div class="benchmark-row">
                <span class="benchmark-label">MS</span>
                <span id="bench-ms" class="benchmark-value">--</span>
            </div>
        </div>
        <div class="benchmark-footer">
            <span class="benchmark-resolution-label">RENDER</span>
            <span class="benchmark-resolution" id="bench-resolution">-- √ó -- (---%)</span>
        </div>
    </div>

    <div id="achievements-screen" class="hidden">
        <div class="ach-header">
            <h1 class="title-text tracking-widest">ACHIEVEMENTS</h1>
            <div class="ach-subtitle">MEDALS OF HONOR</div>
        </div>
        
        <div id="achievements-list" class="achievements-grid">
            <!-- Populated by JS -->
        </div>

        <button id="ach-back-btn">BACK TO BASE</button>
    </div>

    <!-- Settings Screen -->
    <div id="settings-screen" class="hidden">
        <div class="settings-container">
            <div class="settings-header">
                <h1 class="settings-title">GRAPHICS SETTINGS</h1>
                <div class="settings-subtitle">Optimize for your device</div>
            </div>
            
            <div class="settings-content">
                <!-- Quality Presets -->
                <div class="settings-section">
                    <div class="section-title">QUALITY PRESET</div>
                    <div class="quality-presets">
                        <button class="preset-btn" data-quality="0">
                            <span class="preset-icon">üíé</span>
                            <span class="preset-name">ULTRA</span>
                            <span class="preset-desc">Maximum quality</span>
                        </button>
                        <button class="preset-btn" data-quality="1">
                            <span class="preset-icon">‚ú®</span>
                            <span class="preset-name">HIGH</span>
                            <span class="preset-desc">Great visuals</span>
                        </button>
                        <button class="preset-btn" data-quality="2">
                            <span class="preset-icon">‚öñÔ∏è</span>
                            <span class="preset-name">MEDIUM</span>
                            <span class="preset-desc">Balanced</span>
                        </button>
                        <button class="preset-btn" data-quality="3">
                            <span class="preset-icon">üîã</span>
                            <span class="preset-name">LOW</span>
                            <span class="preset-desc">Better FPS</span>
                        </button>
                        <button class="preset-btn" data-quality="4">
                            <span class="preset-icon">‚ö°</span>
                            <span class="preset-name">VERY LOW</span>
                            <span class="preset-desc">Performance</span>
                        </button>
                        <button class="preset-btn active" data-quality="5">
                            <span class="preset-icon">üöÄ</span>
                            <span class="preset-name">LOWEST</span>
                            <span class="preset-desc">Max FPS</span>
                        </button>
                    </div>
                </div>
                
                <!-- Current Settings Display -->
                <div class="settings-section">
                    <div class="section-title">CURRENT SETTINGS</div>
                    <div class="settings-info">
                        <div class="setting-row">
                            <span class="setting-label">Particles</span>
                            <span class="setting-value" id="setting-particles">15%</span>
                        </div>
                        <div class="setting-row">
                            <span class="setting-label">Shadows</span>
                            <span class="setting-value" id="setting-shadows">Off</span>
                        </div>
                        <div class="setting-row">
                            <span class="setting-label">Terrain Detail</span>
                            <span class="setting-value" id="setting-terrain">10%</span>
                        </div>
                        <div class="setting-row">
                            <span class="setting-label">Effects</span>
                            <span class="setting-value" id="setting-effects">20%</span>
                        </div>
                        <div class="setting-row">
                            <span class="setting-label">Tank Tracks</span>
                            <span class="setting-value" id="setting-tracks">Off</span>
                        </div>
                        <div class="setting-row">
                            <span class="setting-label">Floating Text</span>
                            <span class="setting-value" id="setting-floattext">15 max</span>
                        </div>
                        <div class="setting-row">
                            <span class="setting-label">AI Update Rate</span>
                            <span class="setting-value" id="setting-ai">Every 4 frames</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="settings-back-btn" class="settings-back-btn">APPLY & CLOSE</button>
        </div>
    </div>

    <div id="pause-screen" class="hidden">
        <h1 class="title-text" style="font-size: clamp(2.5rem, 8vw, 5rem); margin-bottom: clamp(1.5rem, 4vh, 3rem);">PAUSED</h1>
        <div class="flex flex-col" style="gap: clamp(12px, 2vh, 20px); width: clamp(16rem, 40vw, 20rem);">
            <button id="resume-btn" class="pause-menu-btn" style="background: linear-gradient(135deg, #4a6741, #5a7a50); color: #d4c5b0; border: 3px solid #6b8055;">RESUME</button>
            <button id="restart-pause-btn" class="pause-menu-btn" style="background: linear-gradient(135deg, #a83e20, #b44628); color: #d4c5b0; border: 3px solid #8b5a3c;">RESTART</button>
            <button id="home-btn" class="pause-menu-btn" style="background: rgba(70, 60, 50, 0.95); color: #d4c5b0; border: 3px solid #8b7355;">HOME</button>
        </div>
    </div>

    <div id="gameover-screen" class="hidden">
        <h1 class="title-text" style="font-size: clamp(2.5rem, 8vw, 5rem); margin-bottom: clamp(0.5rem, 1vh, 1rem);">MISSION FAILED</h1>
        <p id="go-score" class="font-mono tracking-wider" style="font-size: clamp(1.2rem, 4vw, 2rem); margin-bottom: clamp(1.5rem, 4vh, 3rem);">SCORE: 0</p>
        <div class="flex flex-col" style="gap: clamp(12px, 2vh, 20px); width: clamp(16rem, 40vw, 20rem);">
            <button id="restart-btn" class="pause-menu-btn" style="background: linear-gradient(135deg, #4a6741, #5a7a50); color: #d4c5b0; border: 3px solid #6b8055;">RETRY MISSION</button>
            <button id="home-gameover-btn" class="pause-menu-btn" style="background: rgba(70, 60, 50, 0.95); color: #d4c5b0; border: 3px solid #8b7355;">BACK TO HOME</button>
        </div>
    </div>

    <!-- Victory Screen -->
    <div id="victory-screen" class="hidden">
        <div class="victory-sparkles"></div>
        <div class="victory-content">
            <div class="victory-badge">
                <div class="victory-trophy">üèÜ</div>
                <div class="victory-rays"></div>
            </div>
            <h1 class="title-text victory-title">VICTORY!</h1>
            <p class="victory-subtitle">OMEGA DESTROYER DEFEATED</p>
            <div class="victory-stats">
                <div class="victory-stat">
                    <span class="stat-label">FINAL SCORE</span>
                    <span id="victory-score" class="stat-value font-mono">0</span>
                </div>
                <div class="victory-stat">
                    <span class="stat-label">MISSION TIME</span>
                    <span id="victory-time" class="stat-value font-mono">00:00</span>
                </div>
            </div>
            <div class="victory-btn-container">
                <button id="home-victory-btn" class="victory-home-btn">
                    <span class="btn-icon">üè†</span>
                    <span class="btn-text">RETURN HOME</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Deploy Confirmation Popup -->
    <div id="deploy-confirm-popup" class="hidden">
        <div class="confirm-popup-content">
            <h2 class="confirm-title">‚ö†Ô∏è ACTIVE MISSION</h2>
            <p class="confirm-text">You have a saved battle in progress. Starting a new mission will erase your current progress.</p>
            <p class="confirm-subtext">Wave <span id="saved-wave-num">?</span> ‚Ä¢ Score <span id="saved-score-num">?</span></p>
            <div class="confirm-buttons">
                <button id="confirm-deploy-btn" class="pause-menu-btn" style="background: linear-gradient(135deg, #a83e20, #b44628); color: #d4c5b0; border: 3px solid #8b5a3c;">NEW MISSION</button>
                <button id="cancel-deploy-btn" class="pause-menu-btn" style="background: rgba(70, 60, 50, 0.95); color: #d4c5b0; border: 3px solid #8b7355;">CANCEL</button>
            </div>
        </div>
    </div>

    <script src="js/splash.js"></script>
    <script src="js/music.js"></script>
    <script src="js/config.js"></script>
    <script src="js/achievements.js"></script>
    <script src="js/saveManager.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/world.js"></script>
    <script src="js/systems.js"></script>
    <!-- render.js must load before gameplay.js (draw() dependency) -->
    <script src="js/render.js"></script>
    <!-- demo.js needs render.js, config.js, world.js -->
    <script src="js/demo.js"></script>
    <!-- systems.js must load before gameplay.js (updateBullets dependency) -->
    <script src="js/gameplay.js"></script>
    <script src="js/input.js"></script>
    <script src="js/main.js"></script>
</html>